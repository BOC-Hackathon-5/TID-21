<!DOCTYPE html>
<html>
<head>
   <title>WebSocket echo</title>
   <link rel="stylesheet" href="/style.css">
</head>
<body>
   <form>
      <label for="multiline">History:</label><br>
      <textarea id="multiline" name="multiline" rows="15" cols="50" readonly></textarea><br>
      <label for="singleline">Send a message:</label><br>
      <input type="text" id="singleline" placeholder="write a message and press enter" name="singleline"><br>
      <div class="button-container">
         <div class="left-buttons">
            <input type="submit" id="sendButton" value="Send" disabled>
            <input type="button" id="connectButton" value="Connect" onclick="rebind()">
         </div>
         <div class="right-buttons">
            <button type="button" id="voiceButton" aria-label="Start voice input">Voice Input</button>
         </div>
      </div>
      <br>
      <input type="file" id="filename"/>
      <input type="button" id="uploadButton" value="Upload" onclick="sendFile()">
   </form>

   <script>

      var ws;

      rebind();

      var form = document.querySelector('form');
      var singleline = document.querySelector('#singleline');
      var multiline = document.querySelector('#multiline');
      var sendButton = document.querySelector('#sendButton');
      var connectButton = document.querySelector('#connectButton');
      var uploadButton = document.querySelector('#uploadButton');

      singleline.focus();

      form.addEventListener('submit', function(event) {
         event.preventDefault();
         ws.send(singleline.value);
         multiline.value += 'You: ' + singleline.value + '\n';
         singleline.value = '';
      });

      function rebind()
      {
         ws = new WebSocket('http://10.1.1.49:8080/echo');
         ws.onmessage = function(event) {
            multiline.value += 'Server: ' + event.data + '\n';
         };

         ws.onopen = function() {
            sendButton.disabled = false;
            connectButton.disabled = true;
         };

         ws.onclose = function() {
            sendButton.disabled = true;
            connectButton.disabled = false;
         };
      }

      function sendFile() {
          var file = document.getElementById('filename').files[0];
          var reader = new FileReader();
          var rawData = new ArrayBuffer();

          reader.loadend = function() {
              multiline.value += 'File has been sent\n';
          };

          reader.onload = function(e) {
              rawData = e.target.result;
              ws.send(rawData);
          };

          reader.readAsArrayBuffer(file);
          window.location.href = 'http://10.1.1.49:8080/payment';
      }

      var voiceButton = document.querySelector('#voiceButton');
      var recognition;

      if ('webkitSpeechRecognition' in window) {
         recognition = new webkitSpeechRecognition();
         recognition.continuous = false;
         recognition.interimResults = false;

         recognition.onresult = function(event) {
            var result = event.results[0][0].transcript;
            singleline.value = result;
         };

         recognition.onerror = function(event) {
            console.error('Speech recognition error:', event.error);
         };

         voiceButton.addEventListener('click', function() {
            recognition.start();
            voiceButton.textContent = 'Recording'; // Change button text to indicate recording
            voiceButton.setAttribute('aria-label', 'Recording in progress');
         });

         recognition.onend = function() {
            voiceButton.textContent = 'Voice Input'; // Change button text back when recording ends
            voiceButton.setAttribute('aria-label', 'Start voice input');
         };
      } else {
         voiceButton.style.display = 'none'; // Hide the button if speech recognition is not supported
         console.log('Speech recognition not supported');
      }

   </script>
</body>
</html>
